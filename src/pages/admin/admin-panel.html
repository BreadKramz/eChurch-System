<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Our Mother of Perpetual Help Redemptorist Church</title>
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon.ico.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#8B4513">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="OMP Church">
    <link rel="apple-touch-icon" href="../../assets/images/Perpetual Church Logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#8B4513',
                        secondary: '#2c3e50',
                        accent: '#34495e'
                    },
                    fontFamily: {
                        'display': ['Playfair Display', 'serif'],
                        'body': ['Roboto', 'sans-serif']
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.8s ease-out forwards',
                        'slide-up': 'slideUp 0.6s ease-out forwards'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(30px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(50px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="../../assets/css/public.css">
</head>
<body class="font-body bg-gray-50">
    <!-- Sidebar -->
    <div class="fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg border-r border-gray-200 admin-sidebar transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out" id="sidebar">
        <!-- Sidebar Header -->
        <div class="flex items-center justify-center h-20 px-4 bg-gradient-to-r from-red-600 to-red-700 border-b border-gray-200">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-white">
                    <img src="../../assets/images/Perpetual Church Logo.png" alt="Church Logo" class="w-full h-full rounded-full object-cover">
                </div>
                <div class="text-white">
                    <h3 class="font-display font-bold text-sm leading-tight">Admin Panel</h3>
                    <p class="text-xs opacity-90 hidden md:block">Administrator</p>
                    <div class="md:hidden">
                        <p class="text-xs opacity-90">Administrator</p>
                        <p class="text-xs opacity-75">Admin</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="flex-1 px-4 py-6 space-y-2">
            <a href="#dashboard" class="flex items-center gap-3 px-4 py-3 text-gray-700 rounded-lg hover:bg-red-50 hover:text-red-600 transition-all duration-200 group active" id="nav-dashboard">
                <i class="fas fa-tachometer-alt text-red-600 text-lg"></i>
                <span class="font-medium">Dashboard</span>
            </a>

            <a href="#users" class="flex items-center gap-3 px-4 py-3 text-gray-700 rounded-lg hover:bg-red-50 hover:text-red-600 transition-all duration-200 group" id="nav-users">
                <i class="fas fa-users text-red-600 text-lg"></i>
                <span class="font-medium">User Management</span>
            </a>


            <a href="#services" class="flex items-center gap-3 px-4 py-3 text-gray-700 rounded-lg hover:bg-red-50 hover:text-red-600 transition-all duration-200 group" id="nav-services">
                <i class="fas fa-concierge-bell text-red-600 text-lg"></i>
                <span class="font-medium">Service Requests</span>
            </a>

            <a href="#announcements" class="flex items-center gap-3 px-4 py-3 text-gray-700 rounded-lg hover:bg-red-50 hover:text-red-600 transition-all duration-200 group" id="nav-announcements">
                <i class="fas fa-bullhorn text-red-600 text-lg"></i>
                <span class="font-medium">Announcements</span>
            </a>

            <a href="#events" class="flex items-center gap-3 px-4 py-3 text-gray-700 rounded-lg hover:bg-red-50 hover:text-red-600 transition-all duration-200 group" id="nav-events">
                <i class="fas fa-calendar-alt text-red-600 text-lg"></i>
                <span class="font-medium">Events</span>
            </a>

        </nav>
    </div>

    <!-- Main Content -->
    <div class="md:ml-64 min-h-screen admin-main">
        <!-- Top Header -->
        <header class="bg-white shadow-sm border-b border-gray-200 px-4 md:px-6 py-4">
            <div class="flex items-center gap-4 w-full">
                <!-- Mobile Menu Button -->
                <button class="md:hidden text-2xl text-red-600 p-2 hover:bg-red-50 rounded-lg transition-all duration-200 flex-shrink-0" id="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>

                <!-- Church Name -->
                <div class="flex-1 min-w-0 hidden md:block">
                    <h1 class="text-xl md:text-2xl font-display font-bold text-red-600 truncate">Our Mother of Perpetual Help</h1>
                    <p class="text-sm text-gray-600 font-body">Redemptorist Church â€¢ Dumaguete City</p>
                </div>

                <!-- Mobile Church Name -->
                <div class="flex-1 min-w-0 md:hidden">
                    <h1 class="text-lg font-display font-bold text-red-600 truncate">OMP Church</h1>
                </div>

                <!-- Profile with Name and Role -->
                <div class="flex-shrink-0">
                    <div class="relative">
                        <button class="flex items-center gap-3 hover:bg-gray-50 rounded-lg p-2 transition-colors duration-200" id="profile-dropdown-btn">
                            <div class="text-right">
                                <p class="text-sm font-medium text-gray-900" id="admin-name">Administrator</p>
                                <p class="text-xs text-gray-500">Admin</p>
                            </div>
                            <div class="w-10 h-10 bg-red-600 rounded-full flex items-center justify-center text-white">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <i class="fas fa-chevron-down text-gray-400 text-sm transition-transform duration-200" id="dropdown-icon"></i>
                        </button>

                        <!-- Logout Confirmation Modal -->
                        <div id="admin-logout-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
                            <div class="bg-white rounded-2xl p-8 max-w-sm mx-4 text-center shadow-2xl">
                                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-sign-out-alt text-red-600 text-2xl"></i>
                                </div>
                                <h3 class="text-xl font-bold text-gray-900 mb-2">Confirm Logout</h3>
                                <p class="text-gray-600 mb-6">Are you sure you want to log out of the admin panel?</p>
                                <div class="flex gap-3">
                                    <button
                                        onclick="closeAdminLogoutModal()"
                                        class="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-all duration-300"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        onclick="confirmAdminLogout()"
                                        class="flex-1 bg-red-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-red-700 transition-all duration-300"
                                    >
                                        Logout
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Dropdown Menu -->
                        <div class="absolute right-0 top-full mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50 hidden" id="profile-dropdown">
                            <button onclick="showAdminProfile()" class="w-full flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-red-600 transition-colors duration-200">
                                <i class="fas fa-user-shield text-red-600"></i>
                                <span>Admin Profile</span>
                            </button>
                            <hr class="border-gray-200 my-1">
                            <button onclick="showAdminLogoutModal()" class="w-full flex items-center gap-3 px-4 py-3 text-red-600 hover:bg-red-50 hover:text-red-700 transition-colors duration-200">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Logout</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Dashboard Content -->
        <main class="p-3 md:p-4">
            <div class="max-w-7xl mx-auto">
                <!-- Content Display Area -->
                <div id="content-area" class="bg-white rounded-lg shadow-lg border border-gray-100 p-4 md:p-6">
                    <!-- Dashboard Overview -->
                    <div id="dashboard-content">

                        <!-- System Information -->
                        <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-100 mb-6">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-info-circle text-blue-600 text-sm"></i>
                                </div>
                                <h3 class="text-lg font-bold text-gray-900">System Information</h3>
                            </div>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Church Name:</span>
                                        <span class="font-medium text-gray-900">Our Mother of Perpetual Help</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Location:</span>
                                        <span class="font-medium text-gray-900">Dumaguete City</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Database:</span>
                                        <span class="font-medium text-gray-900">Supabase</span>
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">System Version:</span>
                                        <span class="font-medium text-gray-900">1.0.0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Last Updated:</span>
                                        <span class="font-medium text-gray-900">October 2025</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">PWA Status:</span>
                                        <span class="font-medium text-green-600">Active</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Stats - Compact -->
                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 text-center border border-blue-200">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm mx-auto mb-2">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="text-lg font-bold text-blue-900" id="total-users">0</div>
                                <div class="text-blue-700 font-medium text-xs">Total Users</div>
                            </div>
                            <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 text-center border border-green-200">
                                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-sm mx-auto mb-2">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                                <div class="text-lg font-bold text-green-900" id="recent-users">0</div>
                                <div class="text-green-700 font-medium text-xs">Recent (7 days)</div>
                            </div>
                            <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 text-center border border-purple-200">
                                <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white text-sm mx-auto mb-2">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="text-lg font-bold text-purple-900" id="active-sessions">0</div>
                                <div class="text-purple-700 font-medium text-xs">Active Sessions</div>
                            </div>
                        </div>

                        <!-- Quick Actions - Compact -->
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-white rounded-xl p-4 shadow-lg border border-gray-100">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-users-cog text-red-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-bold text-gray-900">User Management</h4>
                                        <p class="text-gray-600 text-xs">Manage user accounts</p>
                                    </div>
                                </div>
                                <button
                                    onclick="showSection('users')"
                                    class="w-full bg-red-600 text-white py-2 px-3 rounded-lg font-bold text-sm hover:bg-red-700 transition-all duration-300 shadow hover:shadow-md transform hover:-translate-y-0.5"
                                >
                                    <i class="fas fa-arrow-right mr-1"></i>Manage
                                </button>
                            </div>

                            <div class="bg-white rounded-xl p-4 shadow-lg border border-gray-100">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-concierge-bell text-green-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-bold text-gray-900">Service Requests</h4>
                                        <p class="text-gray-600 text-xs">Manage service requests</p>
                                    </div>
                                </div>
                                <button
                                    onclick="showSection('services')"
                                    class="w-full bg-green-600 text-white py-2 px-3 rounded-lg font-bold text-sm hover:bg-green-700 transition-all duration-300 shadow hover:shadow-md transform hover:-translate-y-0.5"
                                >
                                    <i class="fas fa-arrow-right mr-1"></i>Manage
                                </button>
                            </div>
                        </div>

                        <!-- Additional Quick Actions -->
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-white rounded-xl p-4 shadow-lg border border-gray-100">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-bullhorn text-blue-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-bold text-gray-900">Announcements</h4>
                                        <p class="text-gray-600 text-xs">Post church announcements</p>
                                    </div>
                                </div>
                                <button
                                    onclick="showSection('announcements')"
                                    class="w-full bg-blue-600 text-white py-2 px-3 rounded-lg font-bold text-sm hover:bg-blue-700 transition-all duration-300 shadow hover:shadow-md transform hover:-translate-y-0.5"
                                >
                                    <i class="fas fa-plus mr-1"></i>Manage
                                </button>
                            </div>

                            <div class="bg-white rounded-xl p-4 shadow-lg border border-gray-100">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-calendar-alt text-purple-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-bold text-gray-900">Events</h4>
                                        <p class="text-gray-600 text-xs">Schedule church events</p>
                                    </div>
                                </div>
                                <button
                                    onclick="showSection('events')"
                                    class="w-full bg-purple-600 text-white py-2 px-3 rounded-lg font-bold text-sm hover:bg-purple-700 transition-all duration-300 shadow hover:shadow-md transform hover:-translate-y-0.5"
                                >
                                    <i class="fas fa-plus mr-1"></i>Manage
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- User Management Section -->
                    <div id="users-content" class="hidden">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <button onclick="showSection('dashboard')" class="text-red-600 hover:text-red-700 transition-colors">
                                    <i class="fas fa-arrow-left text-lg"></i>
                                </button>
                                <div>
                                    <h2 class="text-xl font-display font-bold text-gray-900">User Management</h2>
                                </div>
                            </div>
                        </div>


                        <!-- User List - Compact -->
                        <div class="bg-white rounded-xl p-4 shadow-lg border border-gray-100">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 bg-red-600 rounded-full flex items-center justify-center text-white">
                                        <i class="fas fa-list text-sm"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-bold text-gray-900">Registered Users</h4>
                                        <p class="text-gray-600 text-sm">All user accounts</p>
                                    </div>
                                </div>
                                <button
                                    onclick="refreshUserList()"
                                    class="bg-red-600 text-white px-3 py-1.5 rounded text-sm font-medium hover:bg-red-700 transition-all duration-300"
                                >
                                    <i class="fas fa-sync-alt mr-1"></i>Refresh
                                </button>
                            </div>

                            <div id="user-list" class="space-y-2 table-mobile">
                                <!-- User items will be populated here -->
                                <div class="text-center text-gray-500 py-6">
                                    <i class="fas fa-users text-3xl mb-3 text-gray-300"></i>
                                    <p class="text-sm">Loading user list...</p>
                                </div>
                            </div>
                        </div>
                    </div>



                    <!-- Service Requests Section -->
                    <div id="services-content" class="hidden">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <button onclick="showSection('dashboard')" class="text-red-600 hover:text-red-700 transition-colors">
                                    <i class="fas fa-arrow-left text-lg"></i>
                                </button>
                                <div>
                                    <h2 class="text-xl font-display font-bold text-gray-900">Service Requests</h2>
                                </div>
                            </div>
                        </div>

                        <!-- Service Requests List -->
                        <div class="bg-white rounded-xl p-4 shadow-lg border border-gray-100">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex gap-2">
                                    <button
                                        id="filter-all"
                                        class="bg-red-600 text-white px-3 py-1.5 rounded text-sm font-medium hover:bg-red-700 transition-all duration-300"
                                    >
                                        All
                                    </button>
                                    <button
                                        id="filter-certificates"
                                        class="bg-blue-600 text-white px-3 py-1.5 rounded text-sm font-medium hover:bg-blue-700 transition-all duration-300"
                                    >
                                        Certificates
                                    </button>
                                    <button
                                        id="filter-services"
                                        class="bg-green-600 text-white px-3 py-1.5 rounded text-sm font-medium hover:bg-green-700 transition-all duration-300"
                                    >
                                        Services
                                    </button>
                                </div>
                                <button
                                    onclick="refreshServiceRequests()"
                                    class="bg-green-600 text-white px-3 py-1.5 rounded text-sm font-medium hover:bg-green-700 transition-all duration-300"
                                >
                                    <i class="fas fa-sync-alt mr-1"></i>Refresh
                                </button>
                            </div>

                            <div id="service-requests-list" class="space-y-2 table-mobile">
                                <!-- Service requests will be populated here -->
                                <div class="text-center text-gray-500 py-6">
                                    <i class="fas fa-concierge-bell text-3xl mb-3 text-gray-300"></i>
                                    <p class="text-sm">Loading service requests...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Announcements Section -->
                    <div id="announcements-content" class="hidden">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <button onclick="showSection('dashboard')" class="text-red-600 hover:text-red-700 transition-colors">
                                    <i class="fas fa-arrow-left text-lg"></i>
                                </button>
                                <div>
                                    <h2 class="text-xl font-display font-bold text-gray-900">Announcements</h2>
                                </div>
                            </div>
                        </div>

                        <!-- Create Announcement Form -->
                        <div class="bg-white rounded-xl p-4 shadow-lg border border-gray-100 mb-2">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white">
                                    <i class="fas fa-plus text-sm"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-bold text-gray-900">Create Announcement</h4>
                                    <p class="text-gray-600 text-sm">Post a new church announcement</p>
                                </div>
                            </div>

                            <form id="announcement-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Title *</label>
                                    <input
                                        type="text"
                                        id="announcement-title"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                                        required
                                        placeholder="Announcement title"
                                    >
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Content *</label>
                                    <textarea
                                        id="announcement-content"
                                        rows="4"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                                        required
                                        placeholder="Announcement content..."
                                    ></textarea>
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Priority</label>
                                    <select id="announcement-priority" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                                        <option value="low">Low</option>
                                        <option value="normal" selected>Normal</option>
                                        <option value="high">High</option>
                                        <option value="urgent">Urgent</option>
                                    </select>
                                </div>

                                <button
                                    type="submit"
                                    class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-blue-700 transition-all duration-300 shadow hover:shadow-md transform hover:-translate-y-0.5"
                                >
                                    <i class="fas fa-paper-plane mr-2"></i>Post Announcement
                                </button>
                            </form>
                        </div>

                        <!-- Announcements List -->
                        <div class="bg-white rounded-xl p-4 shadow-lg border border-gray-100">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white">
                                        <i class="fas fa-list text-sm"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-bold text-gray-900">All Announcements</h4>
                                        <p class="text-gray-600 text-sm">Manage posted announcements</p>
                                    </div>
                                </div>
                                <button
                                    onclick="refreshAnnouncements()"
                                    class="bg-blue-600 text-white px-3 py-1.5 rounded text-sm font-medium hover:bg-blue-700 transition-all duration-300"
                                >
                                    <i class="fas fa-sync-alt mr-1"></i>Refresh
                                </button>
                            </div>

                            <div id="announcements-list" class="space-y-2 table-mobile">
                                <div class="text-center text-gray-500 py-6">
                                    <i class="fas fa-bullhorn text-3xl mb-3 text-gray-300"></i>
                                    <p class="text-sm">Loading announcements...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Events Section -->
                    <div id="events-content" class="hidden">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <button onclick="showSection('dashboard')" class="text-red-600 hover:text-red-700 transition-colors">
                                    <i class="fas fa-arrow-left text-lg"></i>
                                </button>
                                <div>
                                    <h2 class="text-xl font-display font-bold text-gray-900">Events</h2>
                                </div>
                            </div>
                        </div>

                        <!-- Create Event Form -->
                        <div class="bg-white rounded-xl p-4 shadow-lg border border-gray-100 mb-2">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center text-white">
                                    <i class="fas fa-plus text-sm"></i>
                                </div>
                                <div>
                                    <h4 class="text-lg font-bold text-gray-900">Create Event</h4>
                                    <p class="text-gray-600 text-sm">Schedule a new church event</p>
                                </div>
                            </div>

                            <form id="event-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Event Title *</label>
                                    <input
                                        type="text"
                                        id="event-title"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                        required
                                        placeholder="Event title"
                                    >
                                </div>

                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-1">Date *</label>
                                        <input
                                            type="date"
                                            id="event-date"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                            required
                                        >
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-1">Time</label>
                                        <input
                                            type="time"
                                            id="event-time"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                        >
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Location</label>
                                    <input
                                        type="text"
                                        id="event-location"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                        placeholder="Event location"
                                    >
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Category</label>
                                    <select id="event-category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200">
                                        <option value="general" selected>General</option>
                                        <option value="mass">Mass</option>
                                        <option value="service">Service</option>
                                        <option value="meeting">Meeting</option>
                                        <option value="celebration">Celebration</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Description</label>
                                    <textarea
                                        id="event-description"
                                        rows="3"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                        placeholder="Event description..."
                                    ></textarea>
                                </div>

                                <button
                                    type="submit"
                                    class="w-full bg-purple-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-purple-700 transition-all duration-300 shadow hover:shadow-md transform hover:-translate-y-0.5"
                                >
                                    <i class="fas fa-calendar-plus mr-2"></i>Schedule Event
                                </button>
                            </form>
                        </div>

                        <!-- Events List -->
                        <div class="bg-white rounded-xl p-4 shadow-lg border border-gray-100">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center text-white">
                                        <i class="fas fa-list text-sm"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-bold text-gray-900">All Events</h4>
                                        <p class="text-gray-600 text-sm">Manage scheduled events</p>
                                    </div>
                                </div>
                                <button
                                    onclick="refreshEvents()"
                                    class="bg-purple-600 text-white px-3 py-1.5 rounded text-sm font-medium hover:bg-purple-700 transition-all duration-300"
                                >
                                    <i class="fas fa-sync-alt mr-1"></i>Refresh
                                </button>
                            </div>

                            <div id="events-list" class="space-y-2 table-mobile">
                                <div class="text-center text-gray-500 py-6">
                                    <i class="fas fa-calendar-alt text-3xl mb-3 text-gray-300"></i>
                                    <p class="text-sm">Loading events...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <script>
        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../../assets/js/supabase.js"></script>
    <script src="../../assets/js/admin-utils.js"></script>
    <script>
        // Initialize admin panel
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize sidebar navigation
            initializeSidebar();

            // Show dashboard by default
            showSection('dashboard');

            // Update stats
            updateStats();
            refreshUserList();
        });

        // Initialize sidebar navigation
        function initializeSidebar() {
            const navLinks = document.querySelectorAll('#sidebar nav a');
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const sidebar = document.getElementById('sidebar');

            // Handle navigation clicks
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('href').substring(1); // Remove #

                    // Update active state
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');

                    // Show section
                    showSection(section);

                    // Close mobile menu if open
                    if (window.innerWidth < 768) {
                        sidebar.classList.add('-translate-x-full');
                        sidebar.classList.remove('open');
                    }
                });
            });

            // Handle filter button clicks
            const filterButtons = ['filter-all', 'filter-certificates', 'filter-services'];
            filterButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', function() {
                        const filterType = btnId.replace('filter-', '');
                        applyFilter(filterType);
                    });
                }
            });

            // Mobile menu toggle
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', function() {
                    sidebar.classList.toggle('-translate-x-full');
                    sidebar.classList.toggle('open');
                });
            }

            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(e) {
                if (window.innerWidth < 768) {
                    const sidebar = document.getElementById('sidebar');
                    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
                    if (sidebar && mobileMenuBtn) {
                        // Check if click is outside both sidebar and button
                        const isClickOutside = !sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target);
                        console.log('Mobile click outside check:', { isClickOutside, target: e.target.tagName });
                        if (isClickOutside) {
                            console.log('Closing sidebar');
                            sidebar.classList.add('-translate-x-full');
                            sidebar.classList.remove('open');
                        }
                    }
                }
            });

            // Profile dropdown
            const profileBtn = document.getElementById('profile-dropdown-btn');
            const profileDropdown = document.getElementById('profile-dropdown');
            const dropdownIcon = document.getElementById('dropdown-icon');

            if (profileBtn && profileDropdown) {
                profileBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    profileDropdown.classList.toggle('hidden');
                    dropdownIcon.classList.toggle('rotate-180');
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    if (!profileBtn.contains(e.target)) {
                        profileDropdown.classList.add('hidden');
                        dropdownIcon.classList.remove('rotate-180');
                    }
                });
            }
        }

        // Show different sections
        function showSection(sectionName) {
            const sections = ['dashboard', 'users', 'services', 'announcements', 'events'];
            const navLinks = document.querySelectorAll('#sidebar nav a');

            // Hide all sections
            sections.forEach(section => {
                const element = document.getElementById(section + '-content');
                if (element) element.classList.add('hidden');
            });

            // Show selected section
            const activeSection = document.getElementById(sectionName + '-content');
            if (activeSection) activeSection.classList.remove('hidden');

            // Update navigation active state
            navLinks.forEach(link => {
                const linkSection = link.getAttribute('href').substring(1);
                if (linkSection === sectionName) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });

            // Refresh data when showing sections
            if (sectionName === 'services') {
                refreshServiceRequests();
            } else if (sectionName === 'announcements') {
                refreshAnnouncements();
            } else if (sectionName === 'events') {
                refreshEvents();
            }
        }

        // Show admin logout confirmation modal
        function showAdminLogoutModal() {
            const modal = document.getElementById('admin-logout-modal');
            if (modal) {
                modal.classList.remove('hidden');
            }
        }

        // Close admin logout confirmation modal
        function closeAdminLogoutModal() {
            const modal = document.getElementById('admin-logout-modal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        // Show admin profile modal
        function showAdminProfile() {
            // Create and show profile modal
            const modal = document.createElement('div');
            modal.id = 'admin-profile-modal';
            modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center shadow-2xl">
                    <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-user-shield text-red-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Admin Profile</h3>
                    <p class="text-gray-600 mb-6">Administrator account information and settings</p>
                    <div class="text-left bg-gray-50 rounded-lg p-4 mb-6">
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Role:</span>
                                <span class="font-medium text-gray-900">Administrator</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Email:</span>
                                <span class="font-medium text-gray-900">admin@ompchurchdumaguete.com</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Access Level:</span>
                                <span class="font-medium text-gray-900">Full Administrative</span>
                            </div>
                        </div>
                    </div>
                    <button
                        onclick="closeAdminProfileModal()"
                        class="bg-red-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-red-700 transition-all duration-300"
                    >
                        Close
                    </button>
                </div>
            `;
            document.body.appendChild(modal);

            // Close dropdown
            document.getElementById('profile-dropdown').classList.add('hidden');
        }

        // Close admin profile modal
        function closeAdminProfileModal() {
            const modal = document.getElementById('admin-profile-modal');
            if (modal) {
                modal.remove();
            }
        }

        // Show delete user confirmation modal
        function showDeleteUserModal(email) {
            // Create and show delete confirmation modal
            const modal = document.createElement('div');
            modal.id = 'delete-user-modal';
            modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-sm mx-4 text-center shadow-2xl">
                    <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-user-minus text-red-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Delete User</h3>
                    <p class="text-gray-600 mb-6">Are you sure you want to delete the user with email: <strong>${email}</strong>?</p>
                    <div class="flex gap-3">
                        <button
                            onclick="closeDeleteUserModal()"
                            class="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-all duration-300"
                        >
                            Cancel
                        </button>
                        <button
                            onclick="confirmDeleteUser('${email}')"
                            class="flex-1 bg-red-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-red-700 transition-all duration-300"
                        >
                            Delete
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Close delete user confirmation modal
        function closeDeleteUserModal() {
            const modal = document.getElementById('delete-user-modal');
            if (modal) {
                modal.remove();
            }
        }

        // Confirm delete user
        async function confirmDeleteUser(email) {
            try {
                const result = await AdminUtils.deleteUserByEmail(email);
                if (result.success) {
                    document.getElementById('delete-email').value = '';
                    await updateStats();
                    await refreshUserList();
                    closeDeleteUserModal();
                    showDeleteSuccessModal(1, false, email);
                } else {
                    closeDeleteUserModal();
                    showUserNotFoundModal(email);
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                closeDeleteUserModal();
                showUserNotFoundModal(email);
            }
        }

        // Confirm admin logout
        function confirmAdminLogout() {
            localStorage.removeItem('admin_session');
            window.location.href = '../public/index.html';
        }

        // Update statistics
        async function updateStats() {
            try {
                const stats = await AdminUtils.getUserStats();
                document.getElementById('total-users').textContent = stats.totalUsers;
                document.getElementById('recent-users').textContent = stats.recentUsers;

                // Check for active sessions (users currently logged in)
                // Note: This is a simplified implementation. In a real app, you'd track sessions server-side
                const currentUser = localStorage.getItem('current_user');
                const adminSession = localStorage.getItem('admin_session');
                const activeCount = (currentUser ? 1 : 0) + (adminSession ? 1 : 0);
                document.getElementById('active-sessions').textContent = activeCount;
            } catch (error) {
                console.error('Error updating stats:', error);
                document.getElementById('total-users').textContent = '0';
                document.getElementById('recent-users').textContent = '0';
                document.getElementById('active-sessions').textContent = '0';
            }
        }

        // Show delete success modal
        function showDeleteSuccessModal(count, isAllUsers, email = '') {
            const modal = document.createElement('div');
            modal.id = 'delete-success-modal';
            modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
            const message = isAllUsers
                ? `Successfully deleted ${count} user account(s). All user data has been permanently removed.`
                : `User account "${email}" has been successfully deleted.`;
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-sm mx-4 text-center shadow-2xl">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check text-green-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Deletion Successful</h3>
                    <p class="text-gray-600 mb-6">${message}</p>
                    <button
                        onclick="closeDeleteSuccessModal()"
                        class="bg-green-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-green-700 transition-all duration-300"
                    >
                        OK
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Show user not found modal
        function showUserNotFoundModal(email) {
            const modal = document.createElement('div');
            modal.id = 'user-not-found-modal';
            modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-sm mx-4 text-center shadow-2xl">
                    <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-exclamation-triangle text-yellow-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">User Not Found</h3>
                    <p class="text-gray-600 mb-6">User account "${email}" was not found in the system.</p>
                    <button
                        onclick="closeUserNotFoundModal()"
                        class="bg-yellow-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-yellow-700 transition-all duration-300"
                    >
                        OK
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Close delete success modal
        function closeDeleteSuccessModal() {
            const modal = document.getElementById('delete-success-modal');
            if (modal) {
                modal.remove();
            }
        }

        // Close user not found modal
        function closeUserNotFoundModal() {
            const modal = document.getElementById('user-not-found-modal');
            if (modal) {
                modal.remove();
            }
        }

        // Close edit announcement modal
        function closeEditAnnouncementModal() {
            const modal = document.getElementById('edit-announcement-modal');
            if (modal) modal.remove();
        }

        // Close edit event modal
        function closeEditEventModal() {
            const modal = document.getElementById('edit-event-modal');
            if (modal) modal.remove();
        }

        // View user details
        async function viewUser(email) {
            try {
                // Get user details from Supabase
                const { data, error } = await supabaseClient
                    .from(TABLES.USERS)
                    .select('*')
                    .eq('email', email.toLowerCase())
                    .single();

                if (error) throw error;

                // Create and show user details modal
                const modal = document.createElement('div');
                modal.id = 'view-user-modal';
                modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl p-8 max-w-md mx-4 shadow-2xl">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900">User Details</h3>
                            <button onclick="closeViewUserModal()" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <div class="space-y-4">
                            <div class="flex items-center gap-4">
                                <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center text-white text-xl font-bold">
                                    ${data.first_name.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <h4 class="text-lg font-bold text-gray-900">${data.first_name} ${data.last_name}</h4>
                                    <p class="text-gray-600">${data.email}</p>
                                </div>
                            </div>

                            <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Phone:</span>
                                    <span class="font-medium text-gray-900">${data.phone || 'Not provided'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Role:</span>
                                    <span class="font-medium text-gray-900 capitalize">${data.role || 'user'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Joined:</span>
                                    <span class="font-medium text-gray-900">${new Date(data.created_at).toLocaleDateString()}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Last Login:</span>
                                    <span class="font-medium text-gray-900">${data.last_login ? new Date(data.last_login).toLocaleDateString() : 'Never'}</span>
                                </div>
                            </div>
                        </div>

                        <div class="flex gap-3 mt-6">
                            <button
                                onclick="editUser('${data.email}')"
                                class="flex-1 bg-green-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-green-700 transition-all duration-300"
                            >
                                <i class="fas fa-edit mr-2"></i>Edit User
                            </button>
                            <button
                                onclick="closeViewUserModal()"
                                class="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-all duration-300"
                            >
                                Close
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            } catch (error) {
                console.error('Error viewing user:', error);
                showUserNotFoundModal(email);
            }
        }

        // Edit user
        async function editUser(email) {
            try {
                // Get user details from Supabase
                const { data, error } = await supabaseClient
                    .from(TABLES.USERS)
                    .select('*')
                    .eq('email', email.toLowerCase())
                    .single();

                if (error) throw error;

                // Create and show edit user modal
                const modal = document.createElement('div');
                modal.id = 'edit-user-modal';
                modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl p-8 max-w-md mx-4 shadow-2xl">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900">Edit User</h3>
                            <button onclick="closeEditUserModal()" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <form id="edit-user-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                                <input
                                    type="text"
                                    id="edit-first-name"
                                    value="${data.first_name}"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
                                    required
                                >
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                                <input
                                    type="text"
                                    id="edit-last-name"
                                    value="${data.last_name}"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
                                    required
                                >
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input
                                    type="email"
                                    id="edit-email"
                                    value="${data.email}"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
                                    required
                                >
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                                <input
                                    type="tel"
                                    id="edit-phone"
                                    value="${data.phone || ''}"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
                                >
                            </div>

                            <div class="flex gap-3 mt-6">
                                <button
                                    type="submit"
                                    class="flex-1 bg-green-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-green-700 transition-all duration-300"
                                >
                                    <i class="fas fa-save mr-2"></i>Save Changes
                                </button>
                                <button
                                    type="button"
                                    onclick="closeEditUserModal()"
                                    class="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-all duration-300"
                                >
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                `;
                document.body.appendChild(modal);

                // Handle form submission
                document.getElementById('edit-user-form').addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const updatedData = {
                        first_name: document.getElementById('edit-first-name').value.trim(),
                        last_name: document.getElementById('edit-last-name').value.trim(),
                        email: document.getElementById('edit-email').value.trim().toLowerCase(),
                        phone: document.getElementById('edit-phone').value.trim(),
                        updated_at: new Date().toISOString()
                    };

                    try {
                        const { error: updateError } = await supabaseClient
                            .from(TABLES.USERS)
                            .update(updatedData)
                            .eq('id', data.id);

                        if (updateError) throw updateError;

                        closeEditUserModal();
                        await refreshUserList();
                        await updateStats();

                        // Show success message
                        const successModal = document.createElement('div');
                        successModal.id = 'edit-success-modal';
                        successModal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
                        successModal.innerHTML = `
                            <div class="bg-white rounded-2xl p-8 max-w-sm mx-4 text-center shadow-2xl">
                                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-check text-green-600 text-2xl"></i>
                                </div>
                                <h3 class="text-xl font-bold text-gray-900 mb-2">User Updated</h3>
                                <p class="text-gray-600 mb-6">User information has been successfully updated.</p>
                                <button
                                    onclick="closeEditSuccessModal()"
                                    class="bg-green-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-green-700 transition-all duration-300"
                                >
                                    OK
                                </button>
                            </div>
                        `;
                        document.body.appendChild(successModal);

                    } catch (error) {
                        console.error('Error updating user:', error);
                        alert('Error updating user. Please try again.');
                    }
                });

            } catch (error) {
                console.error('Error editing user:', error);
                showUserNotFoundModal(email);
            }
        }

        // Close view user modal
        function closeViewUserModal() {
            const modal = document.getElementById('view-user-modal');
            if (modal) modal.remove();
        }

        // Close edit user modal
        function closeEditUserModal() {
            const modal = document.getElementById('edit-user-modal');
            if (modal) modal.remove();
        }

        // Close edit success modal
        function closeEditSuccessModal() {
            const modal = document.getElementById('edit-success-modal');
            if (modal) modal.remove();
        }

        // Global variable to store all requests
        let allServiceRequests = [];

        // Refresh service requests list
        async function refreshServiceRequests() {
            try {
                const stats = await AdminUtils.getServiceRequestStats();
                allServiceRequests = stats.requests; // Store all requests globally

                // Apply current filter
                applyFilter();
            } catch (error) {
                console.error('Error refreshing service requests:', error);
                const serviceRequestsList = document.getElementById('service-requests-list');
                serviceRequestsList.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-exclamation-triangle text-4xl mb-4 text-yellow-400"></i>
                        <p>Error loading service requests.</p>
                        <p class="text-sm mt-2">Please try refreshing the page.</p>
                    </div>
                `;
            }
        }

        // Apply filter to service requests
        function applyFilter(filterType = 'all') {
            const serviceRequestsList = document.getElementById('service-requests-list');

            // Update button styles
            const buttons = ['filter-all', 'filter-certificates', 'filter-services'];
            buttons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    if (btnId === `filter-${filterType}`) {
                        btn.classList.remove('bg-gray-600', 'bg-blue-600', 'bg-green-600');
                        btn.classList.add('bg-red-600');
                    } else {
                        btn.classList.remove('bg-red-600');
                        if (btnId === 'filter-all') btn.classList.add('bg-gray-600');
                        if (btnId === 'filter-certificates') btn.classList.add('bg-blue-600');
                        if (btnId === 'filter-services') btn.classList.add('bg-green-600');
                    }
                }
            });

            // Filter requests
            let filteredRequests = allServiceRequests;
            if (filterType === 'certificates') {
                const certificateTypes = ['confirmation', 'mass-offering', 'funeral', 'mass-card', 'sick-call', 'marriage', 'baptism'];
                filteredRequests = allServiceRequests.filter(request => certificateTypes.includes(request.requestType));
            } else if (filterType === 'services') {
                const serviceTypes = ['baptism-service', 'confirmation-service', 'communion', 'marriage-service', 'anointing', 'funeral-service'];
                filteredRequests = allServiceRequests.filter(request => serviceTypes.includes(request.requestType));
            }

            if (filteredRequests.length === 0) {
                serviceRequestsList.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-concierge-bell text-4xl mb-4 text-gray-300"></i>
                        <p>No ${filterType === 'all' ? '' : filterType} requests found.</p>
                        <p class="text-sm mt-2">Service requests from users will appear here.</p>
                    </div>
                `;
                return;
            }

            serviceRequestsList.innerHTML = filteredRequests.map(request => {
                const statusColors = {
                    'pending': 'bg-yellow-100 text-yellow-800',
                    'processing': 'bg-blue-100 text-blue-800',
                    'completed': 'bg-green-100 text-green-800',
                    'cancelled': 'bg-red-100 text-red-800'
                };

                const typeLabels = {
                    'confirmation': 'Certificate: Confirmation',
                    'mass-offering': 'Certificate: Mass Offering',
                    'funeral': 'Certificate: Funeral',
                    'mass-card': 'Certificate: Mass Card',
                    'sick-call': 'Certificate: Sick Call',
                    'marriage': 'Certificate: Marriage',
                    'baptism': 'Certificate: Baptism',
                    'baptism-service': 'Sacramental Service: Baptism Service',
                    'confirmation-service': 'Sacramental Service: Confirmation Service',
                    'communion': 'Sacramental Service: First Holy Communion',
                    'marriage-service': 'Sacramental Service: Marriage Service',
                    'anointing': 'Sacramental Service: Anointing of the Sick',
                    'funeral-service': 'Sacramental Service: Funeral Service'
                };

                return `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-100 hover:bg-gray-100 transition-all duration-200">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white text-sm font-bold">
                                ${request.userName.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div class="font-semibold text-gray-900">${request.userName}</div>
                                <div class="text-sm text-gray-600">${request.userEmail}</div>
                                <div class="text-xs text-gray-500 mt-1">${typeLabels[request.requestType]}</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="text-right mr-3">
                                <div class="text-sm text-gray-500">Submitted</div>
                                <div class="text-sm font-medium text-gray-700">${request.createdAt}</div>
                                ${request.preferredDate ? `<div class="text-xs text-gray-500">Preferred: ${request.preferredDate}</div>` : ''}
                            </div>
                            <div class="flex flex-col gap-1">
                                <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${statusColors[request.status] || 'bg-gray-100 text-gray-800'}">
                                    ${request.status.charAt(0).toUpperCase() + request.status.slice(1)}
                                </span>
                                <div class="flex gap-1">
                                    <button
                                        onclick="viewServiceRequest(${request.id})"
                                        class="bg-blue-500 text-white p-1.5 rounded hover:bg-blue-600 transition-all duration-200"
                                        title="View Details"
                                    >
                                        <i class="fas fa-eye text-xs"></i>
                                    </button>
                                    <button
                                        onclick="updateServiceRequestStatus(${request.id}, 'processing')"
                                        class="bg-yellow-500 text-white p-1.5 rounded hover:bg-yellow-600 transition-all duration-200"
                                        title="Mark as Processing"
                                    >
                                        <i class="fas fa-clock text-xs"></i>
                                    </button>
                                    <button
                                        onclick="updateServiceRequestStatus(${request.id}, 'completed')"
                                        class="bg-green-500 text-white p-1.5 rounded hover:bg-green-600 transition-all duration-200"
                                        title="Mark as Completed"
                                    >
                                        <i class="fas fa-check text-xs"></i>
                                    </button>
                                    <button
                                        onclick="updateServiceRequestStatus(${request.id}, 'cancelled')"
                                        class="bg-red-500 text-white p-1.5 rounded hover:bg-red-600 transition-all duration-200"
                                        title="Reject/Cancel Request"
                                    >
                                        <i class="fas fa-times text-xs"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // View service request details
        async function viewServiceRequest(requestId) {
            try {
                const stats = await AdminUtils.getServiceRequestStats();
                const request = stats.requests.find(r => r.id === requestId);

                if (!request) {
                    showUserNotFoundModal('Request not found');
                    return;
                }

                const modal = document.createElement('div');
                modal.id = 'view-service-request-modal';
                modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl p-8 max-w-lg mx-4 shadow-2xl">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900">Service Request Details</h3>
                            <button onclick="closeViewServiceRequestModal()" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <div class="space-y-4">
                            <div class="flex items-center gap-4">
                                <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center text-white text-xl font-bold">
                                    ${request.userName.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <h4 class="text-lg font-bold text-gray-900">${request.userName}</h4>
                                    <p class="text-gray-600">${request.userEmail}</p>
                                </div>
                            </div>

                            <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Request Type:</span>
                                    <span class="font-medium text-gray-900 capitalize">${request.requestType}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Status:</span>
                                    <span class="font-medium text-gray-900 capitalize">${request.status}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Submitted:</span>
                                    <span class="font-medium text-gray-900">${request.createdAt}</span>
                                </div>
                                ${request.preferredDate ? `
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Preferred Date:</span>
                                    <span class="font-medium text-gray-900">${request.preferredDate}</span>
                                </div>
                                ` : ''}
                                ${request.details ? `
                                <div>
                                    <span class="text-gray-600 block mb-1">Details:</span>
                                    <p class="font-medium text-gray-900 text-sm bg-white p-2 rounded border">${request.details}</p>
                                </div>
                                ` : ''}
                            </div>
                        </div>

                        <div class="flex gap-3 mt-6">
                            <button
                                onclick="updateServiceRequestStatus(${request.id}, 'processing')"
                                class="flex-1 bg-yellow-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-yellow-700 transition-all duration-300"
                            >
                                <i class="fas fa-clock mr-2"></i>Mark Processing
                            </button>
                            <button
                                onclick="updateServiceRequestStatus(${request.id}, 'completed')"
                                class="flex-1 bg-green-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-green-700 transition-all duration-300"
                            >
                                <i class="fas fa-check mr-2"></i>Mark Completed
                            </button>
                            <button
                                onclick="updateServiceRequestStatus(${request.id}, 'cancelled')"
                                class="flex-1 bg-red-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-red-700 transition-all duration-300"
                            >
                                <i class="fas fa-times mr-2"></i>Reject Request
                            </button>
                            <button
                                onclick="closeViewServiceRequestModal()"
                                class="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-all duration-300"
                            >
                                Close
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            } catch (error) {
                console.error('Error viewing service request:', error);
                showUserNotFoundModal('Error loading request details');
            }
        }

        // Update service request status
        async function updateServiceRequestStatus(requestId, newStatus) {
            try {
                const result = await AdminUtils.updateServiceRequestStatus(requestId, newStatus);
                if (result.success) {
                    await refreshServiceRequests();
                    closeViewServiceRequestModal();

                    const statusMessages = {
                        'processing': 'Request marked as processing',
                        'completed': 'Request marked as completed',
                        'cancelled': 'Request rejected/cancelled'
                    };

                    // Show success message
                    const successModal = document.createElement('div');
                    successModal.id = 'status-update-success-modal';
                    successModal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
                    successModal.innerHTML = `
                        <div class="bg-white rounded-2xl p-8 max-w-sm mx-4 text-center shadow-2xl">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-check text-green-600 text-2xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">Status Updated</h3>
                            <p class="text-gray-600 mb-6">${statusMessages[newStatus] || 'Status updated successfully'}.</p>
                            <button
                                onclick="closeStatusUpdateSuccessModal()"
                                class="bg-green-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-green-700 transition-all duration-300"
                            >
                                OK
                            </button>
                        </div>
                    `;
                    document.body.appendChild(successModal);
                } else {
                    alert('Error updating status. Please try again.');
                }
            } catch (error) {
                console.error('Error updating service request status:', error);
                alert('Error updating status. Please try again.');
            }
        }

        // Close view service request modal
        function closeViewServiceRequestModal() {
            const modal = document.getElementById('view-service-request-modal');
            if (modal) modal.remove();
        }

        // Close status update success modal
        function closeStatusUpdateSuccessModal() {
            const modal = document.getElementById('status-update-success-modal');
            if (modal) modal.remove();
        }

        // Show admin success modal
        function showAdminSuccessModal(title, message) {
            const modal = document.createElement('div');
            modal.id = 'admin-success-modal';
            modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-sm mx-4 text-center shadow-2xl">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check text-green-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">${title}</h3>
                    <p class="text-gray-600 mb-6">${message}</p>
                    <button
                        onclick="closeAdminSuccessModal()"
                        class="bg-green-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-green-700 transition-all duration-300"
                    >
                        OK
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Close admin success modal
        function closeAdminSuccessModal() {
            const modal = document.getElementById('admin-success-modal');
            if (modal) modal.remove();
        }

        // Announcement form handler
        document.addEventListener('DOMContentLoaded', function() {
            const announcementForm = document.getElementById('announcement-form');
            if (announcementForm) {
                announcementForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const formData = {
                        title: document.getElementById('announcement-title').value.trim(),
                        content: document.getElementById('announcement-content').value.trim(),
                        priority: document.getElementById('announcement-priority').value
                    };

                    if (!formData.title || !formData.content) {
                        alert('Please fill in all required fields.');
                        return;
                    }

                    const result = await AdminUtils.createAnnouncement(formData);
                    if (result.success) {
                        announcementForm.reset();
                        await refreshAnnouncements();
                        showAdminSuccessModal('Announcement Posted', 'Announcement has been posted successfully!');
                    } else {
                        alert('Error posting announcement: ' + result.error);
                    }
                });
            }

            // Event form handler
            const eventForm = document.getElementById('event-form');
            if (eventForm) {
                eventForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const formData = {
                        title: document.getElementById('event-title').value.trim(),
                        description: document.getElementById('event-description').value.trim(),
                        eventDate: document.getElementById('event-date').value,
                        eventTime: document.getElementById('event-time').value,
                        location: document.getElementById('event-location').value.trim(),
                        category: document.getElementById('event-category').value
                    };

                    if (!formData.title || !formData.eventDate) {
                        alert('Please fill in all required fields.');
                        return;
                    }

                    const result = await AdminUtils.createEvent(formData);
                    if (result.success) {
                        eventForm.reset();
                        await refreshEvents();
                        showAdminSuccessModal('Event Scheduled', 'Event has been scheduled successfully!');
                    } else {
                        alert('Error scheduling event: ' + result.error);
                    }
                });
            }
        });

        // Refresh announcements list
        async function refreshAnnouncements() {
            try {
                const result = await AdminUtils.getAllAnnouncements();
                const announcementsList = document.getElementById('announcements-list');

                if (!result.success || result.data.length === 0) {
                    announcementsList.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-bullhorn text-4xl mb-4 text-gray-300"></i>
                            <p>No announcements found.</p>
                            <p class="text-sm mt-2">Post your first announcement above.</p>
                        </div>
                    `;
                    return;
                }

                const priorityColors = {
                    'low': 'bg-gray-100 text-gray-800',
                    'normal': 'bg-blue-100 text-blue-800',
                    'high': 'bg-orange-100 text-orange-800',
                    'urgent': 'bg-red-100 text-red-800'
                };

                announcementsList.innerHTML = result.data.map(announcement => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-100 hover:bg-gray-100 transition-all duration-200">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm font-bold">
                                ${announcement.title.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div class="font-semibold text-gray-900">${announcement.title}</div>
                                <div class="text-sm text-gray-600">Posted: ${new Date(announcement.created_at).toLocaleDateString()}</div>
                                <div class="text-xs text-gray-500 mt-1">${announcement.content.substring(0, 100)}${announcement.content.length > 100 ? '...' : ''}</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${priorityColors[announcement.priority] || 'bg-gray-100 text-gray-800'}">
                                ${announcement.priority.charAt(0).toUpperCase() + announcement.priority.slice(1)}
                            </span>
                            <div class="flex gap-1">
                                <button
                                    onclick="editAnnouncement(${announcement.id})"
                                    class="bg-blue-500 text-white p-1.5 rounded hover:bg-blue-600 transition-all duration-200"
                                    title="Edit Announcement"
                                >
                                    <i class="fas fa-edit text-xs"></i>
                                </button>
                                <button
                                    onclick="deleteAnnouncement(${announcement.id})"
                                    class="bg-red-500 text-white p-1.5 rounded hover:bg-red-600 transition-all duration-200"
                                    title="Delete Announcement"
                                >
                                    <i class="fas fa-trash text-xs"></i>
                                </button>
                                <button
                                    onclick="updateAnnouncementStatus(${announcement.id}, '${announcement.status === 'active' ? 'archived' : 'active'}')"
                                    class="bg-${announcement.status === 'active' ? 'yellow' : 'green'}-500 text-white p-1.5 rounded hover:bg-${announcement.status === 'active' ? 'yellow' : 'green'}-600 transition-all duration-200"
                                    title="${announcement.status === 'active' ? 'Archive' : 'Activate'}"
                                >
                                    <i class="fas fa-${announcement.status === 'active' ? 'archive' : 'check'} text-xs"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error refreshing announcements:', error);
                const announcementsList = document.getElementById('announcements-list');
                announcementsList.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-exclamation-triangle text-4xl mb-4 text-yellow-400"></i>
                        <p>Error loading announcements.</p>
                        <p class="text-sm mt-2">Please try refreshing the page.</p>
                    </div>
                `;
            }
        }

        // Refresh events list
        async function refreshEvents() {
            try {
                const result = await AdminUtils.getAllEvents();
                const eventsList = document.getElementById('events-list');

                if (!result.success || result.data.length === 0) {
                    eventsList.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-calendar-alt text-4xl mb-4 text-gray-300"></i>
                            <p>No events found.</p>
                            <p class="text-sm mt-2">Schedule your first event above.</p>
                        </div>
                    `;
                    return;
                }

                const statusColors = {
                    'upcoming': 'bg-green-100 text-green-800',
                    'ongoing': 'bg-blue-100 text-blue-800',
                    'completed': 'bg-gray-100 text-gray-800',
                    'cancelled': 'bg-red-100 text-red-800'
                };

                const categoryColors = {
                    'mass': 'bg-yellow-100 text-yellow-800',
                    'service': 'bg-blue-100 text-blue-800',
                    'meeting': 'bg-purple-100 text-purple-800',
                    'celebration': 'bg-pink-100 text-pink-800',
                    'general': 'bg-gray-100 text-gray-800'
                };

                eventsList.innerHTML = result.data.map(event => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-100 hover:bg-gray-100 transition-all duration-200">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center text-white text-sm font-bold">
                                ${event.title.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div class="font-semibold text-gray-900">${event.title}</div>
                                <div class="text-sm text-gray-600">${new Date(event.event_date).toLocaleDateString()}${event.event_time ? ' at ' + event.event_time : ''}</div>
                                <div class="text-xs text-gray-500 mt-1">${event.location || 'No location specified'}</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="text-right mr-3">
                                <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${categoryColors[event.category] || 'bg-gray-100 text-gray-800'}">
                                    ${event.category.charAt(0).toUpperCase() + event.category.slice(1)}
                                </span>
                            </div>
                            <div class="flex flex-col gap-1">
                                <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${statusColors[event.status] || 'bg-gray-100 text-gray-800'}">
                                    ${event.status.charAt(0).toUpperCase() + event.status.slice(1)}
                                </span>
                                <div class="flex gap-1">
                                    <button
                                        onclick="editEvent(${event.id})"
                                        class="bg-blue-500 text-white p-1.5 rounded hover:bg-blue-600 transition-all duration-200"
                                        title="Edit Event"
                                    >
                                        <i class="fas fa-edit text-xs"></i>
                                    </button>
                                    <button
                                        onclick="deleteEvent(${event.id})"
                                        class="bg-red-500 text-white p-1.5 rounded hover:bg-red-600 transition-all duration-200"
                                        title="Delete Event"
                                    >
                                        <i class="fas fa-trash text-xs"></i>
                                    </button>
                                    <button
                                        onclick="updateEventStatus(${event.id}, '${event.status === 'upcoming' ? 'completed' : 'upcoming'}')"
                                        class="bg-${event.status === 'upcoming' ? 'green' : 'blue'}-500 text-white p-1.5 rounded hover:bg-${event.status === 'upcoming' ? 'green' : 'blue'}-600 transition-all duration-200"
                                        title="${event.status === 'upcoming' ? 'Mark Completed' : 'Mark Upcoming'}"
                                    >
                                        <i class="fas fa-${event.status === 'upcoming' ? 'check' : 'calendar'} text-xs"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error refreshing events:', error);
                const eventsList = document.getElementById('events-list');
                eventsList.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-exclamation-triangle text-4xl mb-4 text-yellow-400"></i>
                        <p>Error loading events.</p>
                        <p class="text-sm mt-2">Please try refreshing the page.</p>
                    </div>
                `;
            }
        }

        // Edit announcement
        async function editAnnouncement(id) {
            try {
                const result = await AdminUtils.getAllAnnouncements();
                const announcement = result.data.find(a => a.id === id);

                if (!announcement) {
                    alert('Announcement not found');
                    return;
                }

                const modal = document.createElement('div');
                modal.id = 'edit-announcement-modal';
                modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl p-8 max-w-lg mx-4 shadow-2xl">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900">Edit Announcement</h3>
                            <button onclick="closeEditAnnouncementModal()" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <form id="edit-announcement-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Title *</label>
                                <input
                                    type="text"
                                    id="edit-announcement-title"
                                    value="${announcement.title}"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                                    required
                                    placeholder="Announcement title"
                                >
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Content *</label>
                                <textarea
                                    id="edit-announcement-content"
                                    rows="4"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                                    required
                                    placeholder="Announcement content..."
                                >${announcement.content}</textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Priority</label>
                                <select id="edit-announcement-priority" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200">
                                    <option value="low" ${announcement.priority === 'low' ? 'selected' : ''}>Low</option>
                                    <option value="normal" ${announcement.priority === 'normal' ? 'selected' : ''}>Normal</option>
                                    <option value="high" ${announcement.priority === 'high' ? 'selected' : ''}>High</option>
                                    <option value="urgent" ${announcement.priority === 'urgent' ? 'selected' : ''}>Urgent</option>
                                </select>
                            </div>

                            <div class="flex gap-3 mt-6">
                                <button
                                    type="submit"
                                    class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-blue-700 transition-all duration-300"
                                >
                                    <i class="fas fa-save mr-2"></i>Update Announcement
                                </button>
                                <button
                                    type="button"
                                    onclick="closeEditAnnouncementModal()"
                                    class="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-all duration-300"
                                >
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                `;
                document.body.appendChild(modal);

                // Handle form submission
                document.getElementById('edit-announcement-form').addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const updatedData = {
                        title: document.getElementById('edit-announcement-title').value.trim(),
                        content: document.getElementById('edit-announcement-content').value.trim(),
                        priority: document.getElementById('edit-announcement-priority').value
                    };

                    if (!updatedData.title || !updatedData.content) {
                        alert('Please fill in all required fields.');
                        return;
                    }

                    const updateResult = await AdminUtils.updateAnnouncement(id, updatedData);
                    if (updateResult.success) {
                        closeEditAnnouncementModal();
                        await refreshAnnouncements();
                        showAdminSuccessModal('Announcement Updated', 'Announcement has been updated successfully!');
                    } else {
                        alert('Error updating announcement: ' + updateResult.error);
                    }
                });

            } catch (error) {
                console.error('Error editing announcement:', error);
                alert('Error loading announcement details');
            }
        }

        // Delete announcement
        async function deleteAnnouncement(id) {
            showAdminDeleteModal('Delete Announcement', 'Are you sure you want to delete this announcement? This action cannot be undone.', async () => {
                const result = await AdminUtils.deleteAnnouncement(id);
                if (result.success) {
                    await refreshAnnouncements();
                    showAdminSuccessModal('Announcement Deleted', 'Announcement has been deleted successfully!');
                } else {
                    alert('Error deleting announcement: ' + result.error);
                }
            });
        }

        // Show admin delete modal
        function showAdminDeleteModal(title, message, onConfirm) {
            const modal = document.createElement('div');
            modal.id = 'admin-delete-modal';
            modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-8 max-w-sm mx-4 text-center shadow-2xl">
                    <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">${title}</h3>
                    <p class="text-gray-600 mb-6">${message}</p>
                    <div class="flex gap-3">
                        <button
                            onclick="closeAdminDeleteModal()"
                            class="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-all duration-300"
                        >
                            Cancel
                        </button>
                        <button
                            onclick="confirmAdminDelete(); return false;"
                            class="flex-1 bg-red-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-red-700 transition-all duration-300"
                        >
                            Delete
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Store the callback function globally
            window.adminDeleteCallback = onConfirm;
        }

        // Close admin delete modal
        function closeAdminDeleteModal() {
            const modal = document.getElementById('admin-delete-modal');
            if (modal) modal.remove();
            // Clear the callback
            delete window.adminDeleteCallback;
        }

        // Confirm admin delete
        async function confirmAdminDelete() {
            if (window.adminDeleteCallback) {
                try {
                    // Show loading state
                    const deleteBtn = document.querySelector('#admin-delete-modal button:last-child');
                    if (deleteBtn) {
                        deleteBtn.disabled = true;
                        deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Deleting...';
                    }

                    await window.adminDeleteCallback();
                } catch (error) {
                    console.error('Error in delete callback:', error);
                    alert('Error deleting item: ' + error.message);
                }
            }
            closeAdminDeleteModal();
        }

        // Update announcement status
        async function updateAnnouncementStatus(id, status) {
            const result = await AdminUtils.updateAnnouncementStatus(id, status);
            if (result.success) {
                await refreshAnnouncements();
                showAdminSuccessModal('Status Updated', `Announcement ${status === 'active' ? 'activated' : 'archived'} successfully!`);
            } else {
                alert('Error updating announcement: ' + result.error);
            }
        }

        // Edit event
        async function editEvent(id) {
            try {
                const result = await AdminUtils.getAllEvents();
                const event = result.data.find(e => e.id === id);

                if (!event) {
                    alert('Event not found');
                    return;
                }

                const modal = document.createElement('div');
                modal.id = 'edit-event-modal';
                modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl p-8 max-w-lg mx-4 shadow-2xl">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900">Edit Event</h3>
                            <button onclick="closeEditEventModal()" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>

                        <form id="edit-event-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Event Title *</label>
                                <input
                                    type="text"
                                    id="edit-event-title"
                                    value="${event.title}"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                    required
                                    placeholder="Event title"
                                >
                            </div>

                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Date *</label>
                                    <input
                                        type="date"
                                        id="edit-event-date"
                                        value="${event.event_date}"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                        required
                                    >
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-1">Time</label>
                                    <input
                                        type="time"
                                        id="edit-event-time"
                                        value="${event.event_time || ''}"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                    >
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Location</label>
                                <input
                                    type="text"
                                    id="edit-event-location"
                                    value="${event.location || ''}"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                    placeholder="Event location"
                                >
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Category</label>
                                <select id="edit-event-category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200">
                                    <option value="general" ${event.category === 'general' ? 'selected' : ''}>General</option>
                                    <option value="mass" ${event.category === 'mass' ? 'selected' : ''}>Mass</option>
                                    <option value="service" ${event.category === 'service' ? 'selected' : ''}>Service</option>
                                    <option value="meeting" ${event.category === 'meeting' ? 'selected' : ''}>Meeting</option>
                                    <option value="celebration" ${event.category === 'celebration' ? 'selected' : ''}>Celebration</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-1">Description</label>
                                <textarea
                                    id="edit-event-description"
                                    rows="3"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200"
                                    placeholder="Event description..."
                                >${event.description || ''}</textarea>
                            </div>

                            <div class="flex gap-3 mt-6">
                                <button
                                    type="submit"
                                    class="flex-1 bg-purple-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-purple-700 transition-all duration-300"
                                >
                                    <i class="fas fa-save mr-2"></i>Update Event
                                </button>
                                <button
                                    type="button"
                                    onclick="closeEditEventModal()"
                                    class="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-lg font-medium hover:bg-gray-300 transition-all duration-300"
                                >
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                `;
                document.body.appendChild(modal);

                // Handle form submission
                document.getElementById('edit-event-form').addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const updatedData = {
                        title: document.getElementById('edit-event-title').value.trim(),
                        description: document.getElementById('edit-event-description').value.trim(),
                        eventDate: document.getElementById('edit-event-date').value,
                        eventTime: document.getElementById('edit-event-time').value,
                        location: document.getElementById('edit-event-location').value.trim(),
                        category: document.getElementById('edit-event-category').value
                    };

                    if (!updatedData.title || !updatedData.eventDate) {
                        alert('Please fill in all required fields.');
                        return;
                    }

                    const updateResult = await AdminUtils.updateEvent(id, updatedData);
                    if (updateResult.success) {
                        closeEditEventModal();
                        await refreshEvents();
                        showAdminSuccessModal('Event Updated', 'Event has been updated successfully!');
                    } else {
                        alert('Error updating event: ' + updateResult.error);
                    }
                });

            } catch (error) {
                console.error('Error editing event:', error);
                alert('Error loading event details');
            }
        }

        // Delete event
        async function deleteEvent(id) {
            showAdminDeleteModal('Delete Event', 'Are you sure you want to delete this event? This action cannot be undone.', async () => {
                const result = await AdminUtils.deleteEvent(id);
                if (result.success) {
                    await refreshEvents();
                    showAdminSuccessModal('Event Deleted', 'Event has been deleted successfully!');
                } else {
                    alert('Error deleting event: ' + result.error);
                }
            });
        }

        // Update event status
        async function updateEventStatus(id, status) {
            const result = await AdminUtils.updateEventStatus(id, status);
            if (result.success) {
                await refreshEvents();
                showAdminSuccessModal('Status Updated', `Event marked as ${status} successfully!`);
            } else {
                alert('Error updating event: ' + result.error);
            }
        }

        // Refresh user list
        async function refreshUserList() {
            try {
                const stats = await AdminUtils.getUserStats();
                const userList = document.getElementById('user-list');

                if (stats.users.length === 0) {
                    userList.innerHTML = `
                        <div class="text-center text-gray-500 py-8">
                            <i class="fas fa-users text-4xl mb-4 text-gray-300"></i>
                            <p>No registered users found.</p>
                            <p class="text-sm mt-2">Users will appear here once they register.</p>
                        </div>
                    `;
                    return;
                }

                userList.innerHTML = stats.users.map(user => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-100 hover:bg-gray-100 transition-all duration-200">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-red-600 rounded-full flex items-center justify-center text-white text-sm font-bold">
                                ${user.name.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div class="font-semibold text-gray-900">${user.name}</div>
                                <div class="text-sm text-gray-600">${user.email}</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="text-right mr-3">
                                <div class="text-sm text-gray-500">Joined</div>
                                <div class="text-sm font-medium text-gray-700">${user.createdAt}</div>
                            </div>
                            <div class="flex gap-1">
                                <button
                                    onclick="viewUser('${user.email}')"
                                    class="bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600 transition-all duration-200"
                                    title="View User Details"
                                >
                                    <i class="fas fa-eye text-sm"></i>
                                </button>
                                <button
                                    onclick="editUser('${user.email}')"
                                    class="bg-green-500 text-white p-2 rounded-lg hover:bg-green-600 transition-all duration-200"
                                    title="Edit User"
                                >
                                    <i class="fas fa-edit text-sm"></i>
                                </button>
                                <button
                                    onclick="showDeleteUserModal('${user.email}')"
                                    class="bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition-all duration-200"
                                    title="Delete User"
                                >
                                    <i class="fas fa-trash text-sm"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error refreshing user list:', error);
                const userList = document.getElementById('user-list');
                userList.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-exclamation-triangle text-4xl mb-4 text-yellow-400"></i>
                        <p>Error loading user list.</p>
                        <p class="text-sm mt-2">Please try refreshing the page.</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>